@model QLPhongKham.Models.Invoice

@{
    ViewData["Title"] = "T·∫°o h√≥a ƒë∆°n m·ªõi - Test Simplified";
}

<div class="container mt-4">
    <h2>üß™ T·∫°o h√≥a ƒë∆°n m·ªõi - Simplified Version</h2>
    
    <!-- Test ViewBag -->
    <div class="alert alert-info">
        <h5>üîç DEBUG INFO:</h5>
        <p><strong>ViewBag.CompletedAppointments:</strong> 
            @if (ViewBag.CompletedAppointments == null)
            {
                <span class="badge bg-danger">NULL</span>
            }
            else
            {
                var appointments = (List<QLPhongKham.Models.Appointment>)ViewBag.CompletedAppointments;
                <span class="badge bg-success">@appointments.Count items</span>
                
                @if (appointments.Any())
                {
                    <div class="mt-2">
                        <strong>Cu·ªôc h·∫πn t√¨m th·∫•y:</strong>
                        <ul>
                            @foreach (var app in appointments)
                            {
                                <li>@app.AppointmentDate.ToString("dd/MM/yyyy") - @app.Patient?.FullName - @app.Status</li>
                            }
                        </ul>
                    </div>
                }
            }
        </p>
        
        @if (ViewBag.TestMessage != null)
        {
            <p><strong>Test Message:</strong> @ViewBag.TestMessage</p>
        }
    </div>

    <!-- Simple Tabs (no Bootstrap JS dependency) -->
    <div class="card">
        <div class="card-header">
            <h5>Ch·ªçn c√°ch t·∫°o h√≥a ƒë∆°n</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="card border-primary">
                        <div class="card-header bg-primary text-white">
                            <h6 class="mb-0">üìÖ T·ª´ cu·ªôc h·∫πn ƒë√£ ho√†n th√†nh</h6>
                        </div>
                        <div class="card-body">
                            @if (ViewBag.CompletedAppointments != null)
                            {
                                var appointments = (List<QLPhongKham.Models.Appointment>)ViewBag.CompletedAppointments;
                                if (appointments.Any())
                                {
                                    <div class="alert alert-success">
                                        <strong>‚úÖ T√¨m th·∫•y @appointments.Count cu·ªôc h·∫πn ƒë√£ ho√†n th√†nh ch∆∞a c√≥ h√≥a ƒë∆°n</strong>
                                    </div>
                                    
                                    @foreach (var appointment in appointments)
                                    {
                                        <div class="card mb-2 @(appointment.AppointmentDate.Date == new DateTime(2025, 6, 23) ? "border-warning" : "")">
                                            <div class="card-body py-2">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <strong>@appointment.AppointmentDate.ToString("dd/MM/yyyy HH:mm")</strong>
                                                        @if (appointment.AppointmentDate.Date == new DateTime(2025, 6, 23))
                                                        {
                                                            <span class="badge bg-warning text-dark">Mei Chan 23/6</span>
                                                        }
                                                        <br>
                                                        <small>üë§ @appointment.Patient?.FullName</small>
                                                        <br>
                                                        <small>üè• @appointment.Service?.Name - @appointment.Service?.Price.ToString("N0") VNƒê</small>
                                                    </div>
                                                    <div>
                                                        <form asp-action="Create" method="post" class="d-inline">
                                                            <input type="hidden" name="AppointmentId" value="@appointment.AppointmentId" />
                                                            <button type="submit" class="btn btn-success btn-sm">
                                                                üí∞ T·∫°o h√≥a ƒë∆°n
                                                            </button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                }
                                else
                                {
                                    <div class="alert alert-warning">
                                        <strong>‚ö†Ô∏è Kh√¥ng c√≥ cu·ªôc h·∫πn n√†o ƒë√£ ho√†n th√†nh ch∆∞a c√≥ h√≥a ƒë∆°n</strong>
                                    </div>
                                }
                            }
                            else
                            {
                                <div class="alert alert-danger">
                                    <strong>‚ùå L·ªói: ViewBag.CompletedAppointments is NULL</strong>
                                </div>
                            }
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card border-secondary">
                        <div class="card-header bg-secondary text-white">
                            <h6 class="mb-0">üìù T·∫°o h√≥a ƒë∆°n m·ªõi</h6>
                        </div>
                        <div class="card-body">
                            <p>Form t·∫°o h√≥a ƒë∆°n th·ªß c√¥ng s·∫Ω ·ªü ƒë√¢y...</p>
                            <a href="#" class="btn btn-outline-secondary" onclick="alert('Ch·ª©c nƒÉng n√†y s·∫Ω ƒë∆∞·ª£c ph√°t tri·ªÉn sau!')">
                                ‚ûï T·∫°o h√≥a ƒë∆°n m·ªõi
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    console.log('‚úÖ CreateSimplified view loaded successfully');
    console.log('ViewBag data:', @Html.Raw(Json.Serialize(new { 
        CompletedAppointments = ViewBag.CompletedAppointments,
        TestMessage = ViewBag.TestMessage 
    })));
</script>
