@model QLPhongKham.ViewModels.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard Quản trị";
    ViewData["ShowBreadcrumb"] = false;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="container-fluid px-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center bg-white p-4 rounded shadow-sm">
                <div>
                    <h1 class="h3 mb-1 text-gray-800">
                        <i class="bi bi-speedometer2 text-primary me-2"></i>
                        Dashboard Quản trị
                    </h1>
                    <p class="text-muted mb-0">Tổng quan hoạt động phòng khám</p>
                </div>
                <div class="d-flex align-items-center">
                    <!-- Notifications -->
                    <div class="dropdown me-3">
                        <button class="btn btn-outline-secondary dropdown-toggle position-relative" type="button" id="notificationDropdown" data-bs-toggle="dropdown">
                            <i class="bi bi-bell"></i>
                            @if(Model.Alerts.Any())
                            {
                                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                    @Model.Alerts.Count
                                </span>
                            }
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" style="width: 350px;">
                            <li><h6 class="dropdown-header">Thông báo (@Model.Alerts.Count)</h6></li>
                            @if(Model.Alerts.Any())
                            {
                                @foreach(var alert in Model.Alerts.Take(5))
                                {
                                    <li>
                                        <a class="dropdown-item py-2" href="@alert.ActionUrl">
                                            <div class="d-flex">
                                                <div class="me-3">
                                                    @if(alert.Level == "Danger")
                                                    {
                                                        <i class="bi bi-exclamation-triangle text-danger"></i>
                                                    }
                                                    else if(alert.Level == "Warning")
                                                    {
                                                        <i class="bi bi-exclamation-circle text-warning"></i>
                                                    }
                                                    else
                                                    {
                                                        <i class="bi bi-info-circle text-info"></i>
                                                    }
                                                </div>
                                                <div class="flex-grow-1">
                                                    <div class="fw-bold small">@alert.Title</div>
                                                    <div class="text-muted small">@alert.Message</div>
                                                </div>
                                            </div>
                                        </a>
                                    </li>
                                }
                                @if(Model.Alerts.Count > 5)
                                {
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item text-center small" href="/Admin/Alerts">Xem tất cả thông báo</a></li>
                                }
                            }
                            else
                            {
                                <li><span class="dropdown-item-text text-muted">Không có thông báo mới</span></li>
                            }
                        </ul>
                    </div>
                    
                    <!-- User Info -->
                    <div class="dropdown">
                        <button class="btn btn-outline-primary dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle me-1"></i>
                            @User.Identity.Name
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="/Admin/Profile"><i class="bi bi-person me-2"></i>Hồ sơ</a></li>
                            <li><a class="dropdown-item" href="/Admin/Settings"><i class="bi bi-gear me-2"></i>Cài đặt</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/Account/Logout"><i class="bi bi-box-arrow-right me-2"></i>Đăng xuất</a></li>
                        </ul>
                    </div>
                    
                    <!-- Current Time -->
                    <div class="ms-3 text-muted small">
                        <i class="bi bi-clock me-1"></i>
                        <span id="currentTime">@DateTime.Now.ToString("HH:mm:ss - dd/MM/yyyy")</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="bg-white p-3 rounded shadow-sm">
                <h6 class="fw-bold mb-3"><i class="bi bi-lightning me-2"></i>Thao tác nhanh</h6>
                <div class="d-flex flex-wrap gap-2">
                    <a href="/Admin/Appointment/Create" class="btn btn-primary btn-sm">
                        <i class="bi bi-calendar-plus me-1"></i>Tạo lịch hẹn
                    </a>
                    <a href="/Admin/Patient/Create" class="btn btn-success btn-sm">
                        <i class="bi bi-person-plus me-1"></i>Thêm bệnh nhân
                    </a>
                    <a href="/Admin/Doctor/Create" class="btn btn-info btn-sm">
                        <i class="bi bi-person-badge me-1"></i>Thêm bác sĩ
                    </a>
                    <a href="/Admin/Invoice/Create" class="btn btn-warning btn-sm">
                        <i class="bi bi-receipt me-1"></i>Tạo hóa đơn
                    </a>
                    <a href="/Admin/Medicine/Create" class="btn btn-secondary btn-sm">
                        <i class="bi bi-capsule me-1"></i>Thêm thuốc
                    </a>
                    <a href="/Admin/Reports" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-graph-up me-1"></i>Báo cáo
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Cards -->
    <div class="row mb-4">
        <!-- Today's Appointments -->
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-start border-primary border-4 h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <div class="small fw-bold text-primary text-uppercase mb-1">Lịch hẹn hôm nay</div>
                            <div class="h5 mb-0 fw-bold text-gray-800">@Model.TodayAppointments</div>
                            <div class="text-muted small">
                                Trễ: <span class="text-danger">@Model.LateAppointments</span>
                            </div>
                        </div>
                        <div class="text-primary opacity-50">
                            <i class="bi bi-calendar-check" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- New Patients -->
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-start border-success border-4 h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <div class="small fw-bold text-success text-uppercase mb-1">Bệnh nhân mới</div>
                            <div class="h5 mb-0 fw-bold text-gray-800">@Model.NewPatientsToday</div>
                            <div class="text-muted small">
                                Tháng này: <span class="text-success">@Model.NewPatientsThisMonth</span>
                            </div>
                        </div>
                        <div class="text-success opacity-50">
                            <i class="bi bi-person-plus" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Revenue -->
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-start border-info border-4 h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <div class="small fw-bold text-info text-uppercase mb-1">Doanh thu hôm nay</div>
                            <div class="h5 mb-0 fw-bold text-gray-800">@Model.TodayRevenue.ToString("N0") VNĐ</div>
                            <div class="text-muted small">
                                Tháng này: <span class="text-info">@Model.MonthlyRevenue.ToString("N0") VNĐ</span>
                            </div>
                        </div>
                        <div class="text-info opacity-50">
                            <i class="bi bi-currency-dollar" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Inventory Alerts -->
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card border-start border-warning border-4 h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <div class="small fw-bold text-warning text-uppercase mb-1">Cảnh báo kho</div>
                            <div class="h5 mb-0 fw-bold text-gray-800">@(Model.ExpiredMedicines + Model.LowStockMedicines)</div>
                            <div class="text-muted small">
                                Hết hạn: <span class="text-danger">@Model.ExpiredMedicines</span> |
                                Tồn kho thấp: <span class="text-warning">@Model.LowStockMedicines</span>
                            </div>
                        </div>
                        <div class="text-warning opacity-50">
                            <i class="bi bi-exclamation-triangle" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="row mb-4">
        <!-- Monthly Revenue Chart -->
        <div class="col-xl-8 col-lg-7">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 fw-bold text-primary">Doanh thu 6 tháng gần nhất</h6>
                </div>
                <div class="card-body">
                    <canvas id="revenueChart" width="100%" height="40"></canvas>
                </div>
            </div>
        </div>

        <!-- Appointment Status Chart -->
        <div class="col-xl-4 col-lg-5">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 fw-bold text-primary">Trạng thái lịch hẹn</h6>
                </div>
                <div class="card-body">
                    <canvas id="appointmentStatusChart" width="100%" height="100"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Top Services -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 fw-bold text-primary">Top dịch vụ được sử dụng nhiều nhất</h6>
                </div>
                <div class="card-body">
                    @if(Model.TopServices.Any())
                    {
                        @foreach(var service in Model.TopServices)
                        {
                            <div class="d-flex align-items-center mb-3">
                                <div class="flex-grow-1">
                                    <div class="fw-bold">@service.ServiceName</div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-primary" role="progressbar" style="width: @service.Percentage%" 
                                             aria-valuenow="@service.Percentage" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                                <div class="ms-3 text-end">
                                    <div class="fw-bold text-primary">@service.Count</div>
                                    <div class="small text-muted">@service.Revenue.ToString("N0") VNĐ</div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-muted">Chưa có dữ liệu dịch vụ</p>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Activity Tables -->
    <div class="row mb-4">
        <!-- Today's Appointments -->
        <div class="col-xl-6">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                    <h6 class="m-0 fw-bold text-primary">Lịch hẹn hôm nay</h6>
                    <a href="/Admin/Appointment" class="btn btn-sm btn-outline-primary">Xem tất cả</a>
                </div>
                <div class="card-body">
                    @if(Model.TodayAppointmentsList.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Thời gian</th>
                                        <th>Bệnh nhân</th>
                                        <th>Bác sĩ</th>
                                        <th>Trạng thái</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach(var appointment in Model.TodayAppointmentsList.Take(8))
                                    {
                                        <tr>
                                            <td class="small">@appointment.AppointmentTime.ToString("HH:mm")</td>
                                            <td>
                                                <div class="fw-bold small">@appointment.PatientName</div>
                                                <div class="text-muted small">@appointment.PatientPhone</div>
                                            </td>
                                            <td class="small">@appointment.DoctorName</td>
                                            <td>
                                                @if(appointment.Status == "Completed")
                                                {
                                                    <span class="badge bg-success">Hoàn thành</span>
                                                }
                                                else if(appointment.Status == "Pending")
                                                {
                                                    <span class="badge bg-warning">Chờ khám</span>
                                                }
                                                else if(appointment.Status == "In Progress")
                                                {
                                                    <span class="badge bg-info">Đang khám</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-secondary">@appointment.Status</span>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <p class="text-muted text-center">Không có lịch hẹn nào hôm nay</p>
                    }
                </div>
            </div>
        </div>

        <!-- Unpaid Invoices -->
        <div class="col-xl-6">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                    <h6 class="m-0 fw-bold text-primary">Hóa đơn chưa thanh toán</h6>
                    <a href="/Admin/Invoice" class="btn btn-sm btn-outline-primary">Xem tất cả</a>
                </div>
                <div class="card-body">
                    @if(Model.UnpaidInvoicesList.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Số HĐ</th>
                                        <th>Bệnh nhân</th>
                                        <th>Số tiền</th>
                                        <th>Hạn thanh toán</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach(var invoice in Model.UnpaidInvoicesList.Take(8))
                                    {
                                        <tr class="@(invoice.IsOverdue ? "table-danger" : "")">
                                            <td class="small fw-bold">@invoice.InvoiceNumber</td>
                                            <td class="small">@invoice.PatientName</td>
                                            <td class="small fw-bold">@invoice.RemainingAmount.ToString("N0")</td>
                                            <td class="small">
                                                @if(invoice.DueDate.HasValue)
                                                {
                                                    <span class="@(invoice.IsOverdue ? "text-danger fw-bold" : "")">
                                                        @invoice.DueDate.Value.ToString("dd/MM/yyyy")
                                                    </span>
                                                }
                                                else
                                                {
                                                    <span class="text-muted">-</span>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <p class="text-muted text-center">Tất cả hóa đơn đã được thanh toán</p>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Alerts & Notifications -->
    @if(Model.Alerts.Any())
    {
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header py-3">
                        <h6 class="m-0 fw-bold text-primary">Cảnh báo & Thông báo</h6>
                    </div>
                    <div class="card-body">
                        @foreach(var alert in Model.Alerts.Take(5))
                        {
                            <div class="alert alert-@(alert.Level == "Danger" ? "danger" : alert.Level == "Warning" ? "warning" : "info") alert-dismissible fade show" role="alert">
                                <div class="d-flex align-items-start">
                                    <div class="me-3">
                                        @if(alert.Level == "Danger")
                                        {
                                            <i class="bi bi-exclamation-triangle-fill"></i>
                                        }
                                        else if(alert.Level == "Warning")
                                        {
                                            <i class="bi bi-exclamation-circle-fill"></i>
                                        }
                                        else
                                        {
                                            <i class="bi bi-info-circle-fill"></i>
                                        }
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="alert-heading mb-1">@alert.Title</h6>
                                        <p class="mb-2">@alert.Message</p>
                                        @if(!string.IsNullOrEmpty(alert.ActionUrl))
                                        {
                                            <a href="@alert.ActionUrl" class="btn btn-sm btn-outline-@(alert.Level == "Danger" ? "danger" : alert.Level == "Warning" ? "warning" : "info")">
                                                Xem chi tiết
                                            </a>
                                        }
                                    </div>
                                </div>
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    }
</div>

<script>
// Real-time clock update
function updateTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('vi-VN') + ' - ' + now.toLocaleDateString('vi-VN');
    document.getElementById('currentTime').textContent = timeString;
}
setInterval(updateTime, 1000);

// Revenue Chart
const revenueCtx = document.getElementById('revenueChart').getContext('2d');
const revenueChart = new Chart(revenueCtx, {
    type: 'line',
    data: {
        labels: @Html.Raw(Json.Serialize(Model.MonthlyRevenueChart.Select(m => m.Month))),
        datasets: [{
            label: 'Doanh thu (VNĐ)',
            data: @Html.Raw(Json.Serialize(Model.MonthlyRevenueChart.Select(m => m.Revenue))),
            borderColor: '#4e73df',
            backgroundColor: 'rgba(78, 115, 223, 0.1)',
            borderWidth: 2,
            fill: true,
            tension: 0.4
        }, {
            label: 'Số lịch hẹn',
            data: @Html.Raw(Json.Serialize(Model.MonthlyRevenueChart.Select(m => m.AppointmentCount))),
            borderColor: '#1cc88a',
            backgroundColor: 'rgba(28, 200, 138, 0.1)',
            borderWidth: 2,
            fill: false,
            yAxisID: 'y1',
            tension: 0.4
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    callback: function(value, index, values) {
                        return value.toLocaleString('vi-VN') + ' VNĐ';
                    }
                }
            },
            y1: {
                type: 'linear',
                display: true,
                position: 'right',
                beginAtZero: true,
                grid: {
                    drawOnChartArea: false,
                }
            }
        },
        plugins: {
            tooltip: {
                callbacks: {
                    label: function(context) {
                        if (context.datasetIndex === 0) {
                            return 'Doanh thu: ' + context.parsed.y.toLocaleString('vi-VN') + ' VNĐ';
                        } else {
                            return 'Lịch hẹn: ' + context.parsed.y + ' cuộc';
                        }
                    }
                }
            }
        }
    }
});

// Appointment Status Chart
const appointmentCtx = document.getElementById('appointmentStatusChart').getContext('2d');
const appointmentChart = new Chart(appointmentCtx, {
    type: 'doughnut',
    data: {
        labels: @Html.Raw(Json.Serialize(Model.AppointmentStatusChart.Select(a => a.Status))),
        datasets: [{
            data: @Html.Raw(Json.Serialize(Model.AppointmentStatusChart.Select(a => a.Count))),
            backgroundColor: @Html.Raw(Json.Serialize(Model.AppointmentStatusChart.Select(a => a.Color))),
            borderWidth: 2
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom'
            },
            tooltip: {
                callbacks: {
                    label: function(context) {
                        return context.label + ': ' + context.parsed + ' lịch hẹn';
                    }
                }
            }
        }
    }
});
</script>
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Tổng bệnh nhân
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.TotalPatients</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-person-heart fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <a href="#" class="small text-success">
                        Quản lý bệnh nhân <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Total Doctors Card -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Tổng bác sĩ
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.TotalDoctors</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-person-badge fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <a href="#" class="small text-info">
                        Quản lý bác sĩ <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Today Appointments Card -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Lịch hẹn hôm nay
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.TodayAppointments</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-calendar-check fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <a href="#" class="small text-warning">
                        Xem lịch hẹn <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Row - Additional Statistics -->
    <div class="row">
        <!-- Total Appointments -->
        <div class="col-xl-4 col-md-6 mb-4">
            <div class="card border-left-dark shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-dark text-uppercase mb-1">
                                Tổng lịch hẹn
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.TotalAppointments</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-calendar-week fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pending Appointments -->
        <div class="col-xl-4 col-md-6 mb-4">
            <div class="card border-left-secondary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-secondary text-uppercase mb-1">
                                Chờ xử lý
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.PendingAppointments</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-clock fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Completed Appointments -->
        <div class="col-xl-4 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Đã hoàn thành
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.CompletedAppointments</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-check-circle fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>    </div>

    <!-- Today's Appointments Section -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="bi bi-calendar-day me-2"></i>Lịch hẹn hôm nay
                    </h6>
                    <a asp-controller="Appointment" asp-action="Index" class="btn btn-primary btn-sm">
                        <i class="bi bi-calendar me-1"></i>Xem tất cả
                    </a>
                </div>
                <div class="card-body">
                    @if (Model.TodayAppointmentsList != null && Model.TodayAppointmentsList.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead class="table-light">
                                    <tr>
                                        <th>Thời gian</th>
                                        <th>Bệnh nhân</th>
                                        <th>Bác sĩ</th>
                                        <th>Dịch vụ</th>
                                        <th>Trạng thái</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var appointment in Model.TodayAppointmentsList)
                                    {
                                        <tr>
                                            <td>@appointment.AppointmentTime.ToString("HH:mm")</td>
                                            <td>@appointment.PatientName</td>
                                            <td>@appointment.DoctorName</td>
                                            <td>@appointment.ServiceName</td>
                                            <td>
                                                @switch (appointment.Status)
                                                {
                                                    case "Pending":
                                                        <span class="badge bg-warning">Pending</span>
                                                        break;
                                                    case "In Progress":
                                                        <span class="badge bg-info">In Progress</span>
                                                        break;
                                                    case "Completed":
                                                        <span class="badge bg-success">Completed</span>
                                                        break;
                                                    case "Cancelled":
                                                        <span class="badge bg-danger">Cancelled</span>
                                                        break;
                                                    default:
                                                        <span class="badge bg-secondary">@appointment.Status</span>
                                                        break;
                                                }
                                            </td>
                                            <td>
                                                <a asp-controller="Appointment" asp-action="Details" asp-route-id="@appointment.AppointmentId" 
                                                   class="btn btn-sm btn-outline-primary me-1">
                                                    <i class="bi bi-eye"></i>
                                                </a>
                                                <a asp-controller="Appointment" asp-action="Edit" asp-route-id="@appointment.AppointmentId" 
                                                   class="btn btn-sm btn-outline-secondary">
                                                    <i class="bi bi-pencil"></i>
                                                </a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-4">
                            <i class="bi bi-calendar-x fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">Không có lịch hẹn nào hôm nay</h5>
                            <p class="text-muted">Bạn có thể tạo lịch hẹn mới bằng cách nhấp vào nút bên dưới.</p>
                            <a asp-controller="Appointment" asp-action="Create" class="btn btn-primary">
                                <i class="bi bi-plus-circle me-1"></i>Tạo lịch hẹn mới
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Content Row - Charts and Tables -->
    <div class="row">
        <!-- Quick Actions Card -->
        <div class="col-lg-4 mb-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Thao tác nhanh</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">                        <a asp-controller="UserManagement" asp-action="Index" class="btn btn-primary">
                            <i class="bi bi-people me-2"></i>Quản lý người dùng
                        </a>
                        <a asp-controller="UserManagement" asp-action="CreateStaffAccount" class="btn btn-success">
                            <i class="bi bi-person-plus me-2"></i>Tạo tài khoản nhân viên
                        </a>
                        <a asp-controller="Appointment" asp-action="Create" class="btn btn-info">
                            <i class="bi bi-calendar-plus me-2"></i>Tạo lịch hẹn
                        </a>
                        <a asp-controller="Appointment" asp-action="Index" class="btn btn-warning">
                            <i class="bi bi-calendar me-2"></i>Quản lý lịch hẹn
                        </a>
                        <a asp-controller="Doctor" asp-action="Index" class="btn btn-primary">
                            <i class="bi bi-person-heart me-2"></i>Quản lý bác sĩ
                        </a>
                        <a asp-controller="Service" asp-action="Index" class="btn btn-secondary">
                            <i class="bi bi-gear me-2"></i>Quản lý dịch vụ
                        </a>
                    </div>
                </div>
            </div>

            <!-- System Status -->
            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Trạng thái hệ thống</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="small text-muted">Hoạt động hệ thống</div>
                        <div class="progress">
                            <div class="progress-bar bg-success" style="width: 85%"></div>
                        </div>
                        <div class="small text-success">85% - Tốt</div>
                    </div>
                    <div class="mb-3">
                        <div class="small text-muted">Dung lượng database</div>
                        <div class="progress">
                            <div class="progress-bar bg-info" style="width: 45%"></div>
                        </div>
                        <div class="small text-info">45% - Bình thường</div>
                    </div>
                    <div class="mb-3">
                        <div class="small text-muted">Hiệu suất</div>
                        <div class="progress">
                            <div class="progress-bar bg-warning" style="width: 70%"></div>
                        </div>
                        <div class="small text-warning">70% - Khá tốt</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activities -->
        <div class="col-lg-8 mb-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Hoạt động gần đây</h6>
                    <a href="#" class="text-primary">Xem tất cả</a>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-borderless">
                            <tbody>
                                <tr>
                                    <td class="text-center" style="width: 50px;">
                                        <div class="avatar-circle bg-primary">
                                            <i class="bi bi-person-plus text-white"></i>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="font-weight-bold">Tài khoản mới đăng ký</div>
                                        <div class="small text-muted">Bệnh nhân mới vừa đăng ký tài khoản</div>
                                    </td>
                                    <td class="text-end text-muted small">5 phút trước</td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <div class="avatar-circle bg-success">
                                            <i class="bi bi-calendar-check text-white"></i>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="font-weight-bold">Lịch hẹn được xác nhận</div>
                                        <div class="small text-muted">Bác sĩ Nguyễn Văn A đã xác nhận lịch khám</div>
                                    </td>
                                    <td class="text-end text-muted small">15 phút trước</td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <div class="avatar-circle bg-info">
                                            <i class="bi bi-file-medical text-white"></i>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="font-weight-bold">Bệnh án mới</div>
                                        <div class="small text-muted">Đã tạo bệnh án cho bệnh nhân Trần Thị B</div>
                                    </td>
                                    <td class="text-end text-muted small">30 phút trước</td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <div class="avatar-circle bg-warning">
                                            <i class="bi bi-key text-white"></i>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="font-weight-bold">Phân quyền người dùng</div>
                                        <div class="small text-muted">Admin đã cấp quyền bác sĩ cho user@example.com</div>
                                    </td>
                                    <td class="text-end text-muted small">1 giờ trước</td>
                                </tr>
                                <tr>
                                    <td class="text-center">
                                        <div class="avatar-circle bg-secondary">
                                            <i class="bi bi-gear text-white"></i>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="font-weight-bold">Cập nhật hệ thống</div>
                                        <div class="small text-muted">Đã cập nhật cấu hình hệ thống</div>
                                    </td>
                                    <td class="text-end text-muted small">2 giờ trước</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Row -->
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Thống kê theo vai trò</h6>
                </div>
                <div class="card-body">
                    <canvas id="roleChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Lịch hẹn theo trạng thái</h6>
                </div>
                <div class="card-body">
                    <canvas id="appointmentChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Row - Quick Navigation Cards -->
    <div class="row mb-4">
        <div class="col-12">
            <h4 class="text-gray-800 mb-3">Quản lý Nhân sự</h4>
        </div>
        
        <!-- Staff Management Card -->
        <div class="col-xl-4 col-md-6 mb-4">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Quản lý Nhân viên
                            </div>
                            <div class="h6 mb-0 text-gray-800">CRUD Nhân viên, Phân quyền</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-person-badge fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <a asp-controller="Staff" asp-action="Index" class="small text-info">
                        Quản lý Nhân viên <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Doctor Management Card -->
        <div class="col-xl-4 col-md-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Quản lý Bác sĩ
                            </div>
                            <div class="h6 mb-0 text-gray-800">CRUD Bác sĩ, Chuyên khoa</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-person-heart fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <a asp-controller="Doctor" asp-action="Index" class="small text-warning">
                        Quản lý Bác sĩ <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- User Role Management Card -->
        <div class="col-xl-4 col-md-6 mb-4">
            <div class="card border-left-dark shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-dark text-uppercase mb-1">
                                Phân quyền Người dùng
                            </div>
                            <div class="h6 mb-0 text-gray-800">Gán vai trò, Tạo tài khoản</div>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-shield-check fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <a asp-controller="UserManagement" asp-action="Index" class="small text-dark">
                        Phân quyền Người dùng <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .text-gray-800 {
        color: #5a5c69 !important;
    }

    .text-gray-300 {
        color: #dddfeb !important;
    }

    .avatar-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
</style>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Role Chart
        const roleCtx = document.getElementById('roleChart').getContext('2d');
        const roleChart = new Chart(roleCtx, {
            type: 'doughnut',
            data: {
                labels: ['Bệnh nhân', 'Bác sĩ', 'Nhân viên', 'Admin'],
                datasets: [{
                    data: [@Model.TotalPatients, @Model.TotalDoctors, @Model.TotalStaff, 1],
                    backgroundColor: ['#f6c23e', '#1cc88a', '#36b9cc', '#e74a3b'],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Appointment Chart
        const appointmentCtx = document.getElementById('appointmentChart').getContext('2d');
        const appointmentChart = new Chart(appointmentCtx, {
            type: 'bar',
            data: {
                labels: ['Hôm nay', 'Chờ xử lý', 'Hoàn thành', 'Đã hủy'],
                datasets: [{
                    label: 'Số lượng',
                    data: [@Model.TodayAppointments, @Model.PendingAppointments, @Model.CompletedAppointments, 0],
                    backgroundColor: ['#4e73df', '#858796', '#1cc88a', '#e74a3b'],
                    borderColor: ['#4e73df', '#858796', '#1cc88a', '#e74a3b'],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    </script>
}